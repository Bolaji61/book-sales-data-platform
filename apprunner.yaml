version: 1.0
runtime: python3
build:
  commands:
    - echo "Installing Python dependencies"
    - pip3 install --upgrade pip
    - pip3 install -r requirements.txt
    - echo "DEBUG: Checking Python and pip"
    - which python || echo "python not found"
    - which python3 || echo "python3 not found"
    - python3 --version
    - which pip || echo "pip not found"
    - which pip3 || echo "pip3 not found"
    - pip3 --version
    - ls -lah /usr/local/bin | grep pip || echo "no pip binaries in /usr/local/bin"
run:
  runtime-version: 3.11
  command: python3 main.py
  network:
    port: 8000
  env:
    REDSHIFT_CLUSTER: ${REDSHIFT_CLUSTER}
    REDSHIFT_ENDPOINT: ${REDSHIFT_ENDPOINT}
    REDSHIFT_PORT: ${REDSHIFT_PORT}
    REDSHIFT_DB: ${REDSHIFT_DB}
    REDSHIFT_USER: ${REDSHIFT_USER}
    REDSHIFT_PASSWORD: ${REDSHIFT_PASSWORD}
    REDSHIFT_ROLE_ARN: ${REDSHIFT_ROLE_ARN}
    S3_BUCKET_NAME: ${S3_BUCKET_NAME}
    S3_PREFIX: ${S3_PREFIX}
    DATA_SOURCE_TYPE: s3
    DATA_DIR: data
    AWS_REGION: ${AWS_REGION}
    AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
    AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
    SNS_TOPIC_ARN: ${SNS_TOPIC_ARN}
